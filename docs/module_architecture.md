# BANTU CRM 系统功能模块架构

## 模块划分总览

基于数据库架构和业务流程，系统功能模块划分为以下8个核心模块：

```
BANTU CRM 系统
├── 1. 基础管理模块 (Foundation)
│   ├── 1.1 组织管理
│   ├── 1.2 用户与权限管理
│   └── 1.3 系统配置
├── 2. 产品管理模块 (Product)
│   ├── 2.1 产品分类管理
│   ├── 2.2 产品信息管理
│   └── 2.3 产品定价管理
├── 3. 客户管理模块 (Customer)
│   ├── 3.1 客户信息管理
│   ├── 3.2 客户分类管理
│   ├── 3.3 联系人管理
│   └── 3.4 客户跟进记录
├── 4. 订单管理模块 (Order)
│   ├── 4.1 订单创建与编辑
│   ├── 4.2 订单分配管理
│   ├── 4.3 订单阶段跟踪
│   ├── 4.4 订单进度管理
│   └── 4.5 订单查询与统计
├── 5. 交付管理模块 (Delivery)
│   ├── 5.1 交付物上传
│   ├── 5.2 交付物审核
│   └── 5.3 交付物下载
├── 6. 财务管理模块 (Finance)
│   ├── 6.1 收款管理
│   ├── 6.2 付款管理
│   ├── 6.3 财务报表
│   └── 6.4 财务统计
├── 7. 供应商管理模块 (Vendor)
│   ├── 7.1 供应商信息管理
│   ├── 7.2 供应商员工管理
│   ├── 7.3 供应商任务分配
│   └── 7.4 供应商结算
└── 8. 渠道代理模块 (Agent)
    ├── 8.1 渠道代理管理
    ├── 8.2 渠道客户管理
    ├── 8.3 佣金管理
    └── 8.4 渠道统计
```

---

## 1. 基础管理模块 (Foundation)

### 1.1 组织管理
**功能描述**：管理系统内部组织、供应商组织、渠道代理组织

**核心功能**：
- 组织信息管理（创建、编辑、删除、启用/禁用）
- 组织层级管理（支持组织树结构，如：公司 → 部门 → 团队）
- 组织类型管理（internal/vendor/agent）
- 组织扩展信息管理（vendor_extensions, agent_extensions）
- 组织查询与统计

**涉及表**：
- `organizations`
- `vendor_extensions`
- `agent_extensions`

**权限**：
- ADMIN：所有组织的增删改查
- 其他角色：查看所属组织信息

---

### 1.2 用户与权限管理
**功能描述**：管理系统用户、角色分配、权限控制

**核心功能**：
- 用户管理（创建、编辑、删除、启用/禁用）
- 用户组织关联（organization_employees）
- 角色管理（ADMIN, SALES, AGENT, OPERATION, FINANCE）
- 用户角色分配
- 用户登录认证
- 用户信息查询

**涉及表**：
- `users`
- `roles`
- `user_roles`
- `organization_employees`
- `organizations`

**权限**：
- ADMIN：所有用户的增删改查
- 其他角色：查看个人信息、修改密码

---

### 1.3 系统配置
**功能描述**：系统基础配置和参数管理

**核心功能**：
- 系统参数配置
- 数据字典管理
- 系统日志查看
- 操作审计

**涉及表**：
- 系统配置表（待设计）

**权限**：
- ADMIN：所有配置权限

---

## 2. 产品管理模块 (Product)

### 2.1 产品分类管理
**功能描述**：管理产品分类体系

**核心功能**：
- 产品分类创建、编辑、删除
- 分类层级管理
- 分类查询

**涉及表**：
- `product_categories`

**权限**：
- ADMIN：所有权限
- SALES：查看权限

---

### 2.2 产品信息管理
**功能描述**：管理产品/服务信息

**核心功能**：
- 产品创建、编辑、删除、启用/禁用
- 产品基本信息管理（名称、代码、描述）
- 产品与供应商关联
- 产品与分类关联
- 产品查询与搜索
- 产品详情查看

**涉及表**：
- `products`
- `product_categories`
- `organizations` (vendor)

**权限**：
- ADMIN：所有权限
- SALES：查看权限

---

### 2.3 产品定价管理
**功能描述**：管理产品价格体系

**核心功能**：
- 产品定价设置（定价、渠道价、成本价）
- 价格历史记录
- 价格调整审批（可选）
- 价格查询

**涉及表**：
- `products` (price_list, price_channel, price_cost)

**权限**：
- ADMIN：所有权限
- SALES：查看权限

---

## 3. 客户管理模块 (Customer)

### 3.1 客户信息管理
**功能描述**：管理客户基本信息

**核心功能**：
- 客户创建、编辑、删除
- 客户基本信息管理（名称、代码、联系方式）
- 客户分类（个人/组织、内部/渠道）
- 客户层级管理（组织下的个人客户）
- 客户查询与搜索
- 客户详情查看

**涉及表**：
- `customers`
- `customer_sources`
- `customer_channels`

**权限**：
- ADMIN：所有客户
- SALES：自己开发的客户（customer_source_type = 'own'）
- AGENT：自己带来的渠道客户（customer_source_type = 'agent'）
- OPERATION/FINANCE：查看相关订单的客户信息

---

### 3.2 客户分类管理
**功能描述**：管理客户来源和渠道分类

**核心功能**：
- 客户来源管理（customer_sources）
- 客户渠道管理（customer_channels）
- 客户分类查询

**涉及表**：
- `customer_sources`
- `customer_channels`

**权限**：
- ADMIN：所有权限
- 其他角色：查看权限

---

### 3.3 联系人管理
**功能描述**：管理组织客户下的联系人

**核心功能**：
- 联系人创建、编辑、删除
- 联系人信息管理（姓名、职位、联系方式）
- 主要联系人设置
- 联系人查询

**涉及表**：
- `contacts`
- `customers`

**权限**：
- ADMIN：所有联系人
- SALES：自己客户下的联系人
- AGENT：自己客户下的联系人

---

### 3.4 客户跟进记录
**功能描述**：记录客户跟进历史和活动

**核心功能**：
- 跟进记录创建、编辑
- 跟进记录查询
- 跟进统计（待设计活动表）

**涉及表**：
- `customers` (相关字段)
- 活动记录表（待设计）

**权限**：
- SALES：自己客户的跟进记录
- AGENT：自己客户的跟进记录
- ADMIN：所有跟进记录

---

## 4. 订单管理模块 (Order)

### 4.1 订单创建与编辑
**功能描述**：创建和管理订单

**核心功能**：
- 订单创建（关联客户、产品、销售）
- 订单编辑（状态、金额、备注）
- 订单编号生成
- 订单详情查看
- 订单删除（软删除）

**涉及表**：
- `orders`
- `customers`
- `products`
- `users` (sales_user_id)
- `order_statuses`

**权限**：
- SALES：创建订单、编辑自己的订单
- ADMIN：所有订单的增删改查
- OPERATION：查看分配给自己的订单
- FINANCE：查看订单财务信息

---

### 4.2 订单分配管理
**功能描述**：管理订单分配给做单人员

**核心功能**：
- 订单分配给内部做单人员
- 订单分配给供应商/供应商员工
- 订单重新分配
- 订单分配记录查询
- 订单分配取消

**涉及表**：
- `order_assignments`
- `orders`
- `users` (OPERATION)
- `organizations` (vendor)
- `organization_employees` (vendor employee)

**权限**：
- ADMIN：所有订单分配
- OPERATION：查看分配给自己的订单
- 供应商员工：查看分配给自己的任务

---

### 4.3 订单阶段跟踪
**功能描述**：管理订单的分阶段进度

**核心功能**：
- 订单阶段创建（如：资料审核、办理中、交付）
- 阶段状态更新（pending/in_progress/completed）
- 阶段进度更新（progress_percent）
- 阶段负责人分配
- 阶段完成时间记录
- 阶段查询

**涉及表**：
- `order_stages`
- `orders`
- `users`

**权限**：
- OPERATION：更新分配给自己的订单阶段
- ADMIN：所有订单阶段管理
- SALES：查看自己订单的阶段进度

---

### 4.4 订单进度管理
**功能描述**：整体订单进度管理和状态流转

**核心功能**：
- 订单状态流转（draft → submitted → assigned → in_progress → completed）
- 订单进度总览
- 订单状态历史记录
- 订单暂停/恢复

**涉及表**：
- `orders`
- `order_statuses`
- `order_stages`

**权限**：
- OPERATION：更新订单状态和进度
- ADMIN：所有订单状态管理
- SALES：查看订单进度

---

### 4.5 订单查询与统计
**功能描述**：订单查询和统计分析

**核心功能**：
- 订单列表查询（支持多条件筛选）
- 订单详情查看
- 订单统计（按状态、按销售、按客户等）
- 订单导出
- 订单搜索

**涉及表**：
- `orders`
- `customers`
- `products`
- `users`
- `order_statuses`

**权限**：
- 各角色根据权限查看相应订单

---

## 5. 交付管理模块 (Delivery)

### 5.1 交付物上传
**功能描述**：上传订单交付物

**核心功能**：
- 交付物上传（文件、文档、证书等）
- 交付物信息填写（名称、描述、类型）
- 交付物关联订单和订单阶段
- 文件存储（OSS/本地）
- 交付物列表查看

**涉及表**：
- `deliverables`
- `orders`
- `order_stages`

**权限**：
- OPERATION：上传交付物
- ADMIN：所有交付物管理
- SALES：查看自己订单的交付物
- 客户：查看自己订单的交付物（可选）

---

### 5.2 交付物审核
**功能描述**：审核交付物质量

**核心功能**：
- 交付物审核（通过/不通过）
- 审核意见记录
- 交付物重新提交
- 审核记录查询

**涉及表**：
- `deliverables`
- `users` (verified_by)

**权限**：
- ADMIN：审核所有交付物
- OPERATION：审核自己或下属的交付物
- SALES：审核自己订单的交付物

---

### 5.3 交付物下载
**功能描述**：交付物下载和查看

**核心功能**：
- 交付物下载
- 交付物在线预览
- 交付物访问权限控制
- 下载记录（可选）

**涉及表**：
- `deliverables`

**权限**：
- 根据订单权限控制交付物访问

---

## 6. 财务管理模块 (Finance)

### 6.1 收款管理
**功能描述**：管理客户收款

**核心功能**：
- 收款记录创建（全款/部分收款/退款）
- 收款信息填写（金额、方式、日期、交易流水号）
- 收款确认（FINANCE）
- 收款状态管理（pending/confirmed/failed/refunded）
- 收款记录查询
- 收款统计

**涉及表**：
- `payments`
- `orders`
- `users` (confirmed_by, created_by)

**权限**：
- FINANCE：所有收款管理
- SALES：创建收款记录、查看自己订单的收款
- ADMIN：所有收款管理

---

### 6.2 付款管理
**功能描述**：管理供应商付款

**核心功能**：
- 供应商账单创建
- 付款记录创建
- 付款审核
- 付款状态管理
- 付款记录查询
- 付款统计

**涉及表**：
- 供应商账单表（待设计）
- `payments` (扩展用于付款)

**权限**：
- FINANCE：所有付款管理
- ADMIN：所有付款管理

---

### 6.3 财务报表
**功能描述**：生成各类财务报表

**核心功能**：
- 收入报表（按时间、按销售、按客户）
- 成本报表（按供应商、按产品）
- 利润报表
- 应收款报表
- 应付款报表
- 财务报表导出

**涉及表**：
- `orders`
- `payments`
- `products`
- `customers`

**权限**：
- FINANCE：所有报表
- ADMIN：所有报表
- SALES：个人业绩报表

---

### 6.4 财务统计
**功能描述**：财务数据统计和分析

**核心功能**：
- 收入统计（总计、趋势、对比）
- 成本统计
- 利润分析
- 回款率统计
- 财务数据可视化

**涉及表**：
- `orders`
- `payments`
- `products`

**权限**：
- FINANCE：所有统计
- ADMIN：所有统计

---

## 7. 供应商管理模块 (Vendor)

### 7.1 供应商信息管理
**功能描述**：管理供应商组织信息

**核心功能**：
- 供应商创建、编辑、删除
- 供应商基本信息管理（名称、联系方式、地址）
- 供应商扩展信息管理（account_group, category_name）
- 供应商状态管理（启用/禁用）
- 供应商查询

**涉及表**：
- `organizations` (organization_type = 'vendor')
- `vendor_extensions`

**权限**：
- ADMIN：所有供应商管理
- OPERATION：查看供应商信息

---

### 7.2 供应商员工管理
**功能描述**：管理供应商组织的员工

**核心功能**：
- 供应商员工创建、编辑、删除
- 员工信息管理（姓名、职位、联系方式）
- 员工状态管理（启用/禁用）
- 员工查询

**涉及表**：
- `organization_employees`
- `organizations` (vendor)

**权限**：
- ADMIN：所有供应商员工管理
- OPERATION：查看供应商员工信息

---

### 7.3 供应商任务分配
**功能描述**：将订单任务分配给供应商

**核心功能**：
- 订单分配给供应商
- 订单分配给供应商员工
- 供应商任务查询
- 供应商任务状态更新

**涉及表**：
- `order_assignments`
- `organizations` (vendor)
- `organization_employees`

**权限**：
- ADMIN：所有供应商任务分配
- OPERATION：分配任务给供应商
- 供应商员工：查看分配给自己的任务

---

### 7.4 供应商结算
**功能描述**：管理供应商费用结算

**核心功能**：
- 供应商费用记录
- 供应商账单管理
- 供应商结算审核
- 供应商结算查询

**涉及表**：
- 供应商账单表（待设计）
- `payments` (扩展用于付款给供应商)

**权限**：
- FINANCE：所有供应商结算
- ADMIN：所有供应商结算

---

## 8. 渠道代理模块 (Agent)

### 8.1 渠道代理管理
**功能描述**：管理渠道代理组织

**核心功能**：
- 渠道代理创建、编辑、删除
- 代理基本信息管理
- 代理扩展信息管理
- 代理状态管理
- 代理查询

**涉及表**：
- `organizations` (organization_type = 'agent')
- `agent_extensions`

**权限**：
- ADMIN：所有渠道代理管理
- SALES：查看渠道代理信息

---

### 8.2 渠道客户管理
**功能描述**：管理渠道代理带来的客户

**核心功能**：
- 渠道客户创建（由AGENT角色）
- 渠道客户查询
- 渠道客户统计
- 渠道客户归属管理

**涉及表**：
- `customers` (customer_source_type = 'agent')
- `organizations` (agent)
- `users` (AGENT role)

**权限**：
- AGENT：自己带来的渠道客户
- ADMIN：所有渠道客户
- SALES：查看渠道客户（只读）

---

### 8.3 佣金管理
**功能描述**：管理渠道代理佣金

**核心功能**：
- 佣金计算规则设置
- 佣金记录生成
- 佣金结算管理
- 佣金查询与统计
- 佣金报表

**涉及表**：
- 佣金表（待设计）
- `orders`
- `customers` (agent)

**权限**：
- FINANCE：所有佣金管理
- ADMIN：所有佣金管理
- AGENT：查看自己的佣金

---

### 8.4 渠道统计
**功能描述**：渠道代理数据统计

**核心功能**：
- 渠道客户统计
- 渠道订单统计
- 渠道业绩统计
- 渠道排名

**涉及表**：
- `customers` (agent)
- `orders`
- `organizations` (agent)

**权限**：
- ADMIN：所有渠道统计
- AGENT：自己的渠道统计

---

## 模块开发优先级

### 第一阶段（MVP核心功能）
1. **基础管理模块** - 用户认证、组织管理
2. **客户管理模块** - 客户信息管理
3. **订单管理模块** - 订单创建、分配、阶段跟踪
4. **交付管理模块** - 交付物上传

### 第二阶段（业务流程完善）
5. **财务管理模块** - 收款管理、财务报表
6. **产品管理模块** - 产品信息管理
7. **供应商管理模块** - 供应商信息、任务分配

### 第三阶段（扩展功能）
8. **渠道代理模块** - 渠道管理、佣金管理
9. **系统配置模块** - 系统参数、日志审计
10. **高级功能** - 数据分析、报表定制

---

## 模块间依赖关系

```
基础管理模块 (Foundation)
  ├── 用户与权限 → 所有模块依赖
  └── 组织管理 → 产品、客户、订单模块依赖

产品管理模块 (Product)
  └── 订单模块依赖

客户管理模块 (Customer)
  └── 订单模块依赖

订单管理模块 (Order)
  ├── 依赖：产品、客户、基础管理
  ├── 交付管理模块依赖
  └── 财务管理模块依赖

交付管理模块 (Delivery)
  └── 依赖：订单模块

财务管理模块 (Finance)
  ├── 依赖：订单模块
  └── 供应商管理模块依赖

供应商管理模块 (Vendor)
  ├── 依赖：订单模块
  └── 财务管理模块依赖

渠道代理模块 (Agent)
  ├── 依赖：客户、订单模块
  └── 财务管理模块依赖
```

---

## 技术实现建议

### 后端API设计
- 每个模块对应独立的API路由组
- RESTful API设计规范
- 统一的权限验证中间件
- 统一的错误处理

### 前端页面组织
- 按模块组织页面组件
- 统一的权限控制组件
- 统一的数据表格组件
- 统一的表单组件

### 数据库设计
- 已完成核心表结构设计（见 `sql/schema.sql`）
- 部分扩展表待设计（如：活动记录、佣金、供应商账单）

---

## 总结

本系统共分为 **8个核心功能模块**，涵盖从基础管理到业务运营的完整流程。建议按照优先级分阶段开发，先实现MVP核心功能，再逐步完善扩展功能。

