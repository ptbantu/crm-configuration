digraph BANTU_CRM {
  rankdir=LR;
  node [shape=record, style=filled, fillcolor=lightblue];
  
  // User & Role Domain
  organizations [label="organizations|id (PK)\lname\lcode (UNIQUE)\lorganization_type\lparent_id (FK)\lemail\lphone\lwebsite\lis_active\lcreated_at\lupdated_at"];
  organization_employees [label="organization_employees|id (PK)\lorganization_id (FK)\luser_id (FK)\lfirst_name\llast_name\lemail\lphone\lposition\ldepartment\lemployee_number\lis_primary\lis_manager\lis_decision_maker\lis_active\lcreated_at\lupdated_at"];
  users [label="users|id (PK)\lusername\lemail\lphone\lpassword_hash\ldisplay_name\lorganization_id (FK)\lis_active\lcreated_at\lupdated_at"];
  roles [label="roles|id (PK)\lcode (UNIQUE)\lname\ldescription\lcreated_at\lupdated_at"];
  user_roles [label="user_roles|user_id (FK)\lrole_id (FK)"];
  
  // Product Domain
  product_categories [label="product_categories|id (PK)\lcode (UNIQUE)\lname\lcreated_at\lupdated_at"];
  products [label="products|id (PK)\lcode\lname\lvendor_id (FK)\lcategory_id (FK)\lprice_list\lprice_channel\lprice_cost\lis_active\lcreated_at\lupdated_at"];
  
  // Organization Extensions
  vendor_extensions [label="vendor_extensions|organization_id (PK)\laccount_group\lcategory_name\lcreated_at\lupdated_at"];
  agent_extensions [label="agent_extensions|organization_id (PK)\laccount_group\lcategory_name\lcreated_at\lupdated_at"];
  
  // Customer Domain
  customer_sources [label="customer_sources|id (PK)\lcode (UNIQUE)\lname\lcreated_at\lupdated_at"];
  customer_channels [label="customer_channels|id (PK)\lcode (UNIQUE)\lname\lcreated_at\lupdated_at"];
  customers [label="customers|id (PK)\lcode\lname\lcustomer_source_type\lcustomer_type\lowner_user_id (FK)\lagent_id (FK)\lagent_user_id (FK)\lparent_customer_id (FK)\lsource_id (FK)\lchannel_id (FK)\lcreated_at\lupdated_at"];
  contacts [label="contacts|id (PK)\lcustomer_id (FK)\lfirst_name\llast_name\lemail\lphone\lis_primary\lis_decision_maker\lis_active\lcreated_at\lupdated_at"];
  visa_records [label="visa_records|id (PK)\lcustomer_id (FK)\lcustomer_name\lpassport_id\lentry_city\lcurrency_code\lfx_rate\lpayment_amount\lcreated_at\lupdated_at"];
  
  // Order Domain
  order_statuses [label="order_statuses|id (PK)\lcode (UNIQUE)\lname\ldisplay_order\lcreated_at\lupdated_at"];
  orders [label="orders|id (PK)\lorder_number (UNIQUE)\ltitle\lcustomer_id (FK)\lproduct_id (FK)\lsales_user_id (FK)\lstatus_id (FK)\lquantity\lunit_price\ltotal_amount\lfinal_amount\lcreated_at\lupdated_at"];
  order_assignments [label="order_assignments|id (PK)\lorder_id (FK)\lassigned_to_user_id (FK)\lassigned_by_user_id (FK)\lvendor_id (FK)\lorganization_employee_id (FK)\lvendor_employee_id (FK)\lassignment_type\lis_primary\lassigned_at\lunassigned_at\lcreated_at"];
  order_stages [label="order_stages|id (PK)\lorder_id (FK)\lassigned_to_user_id (FK)\lstage_name\lstage_code\lstage_order\lstatus\lprogress_percent\lcreated_at\lupdated_at"];
  deliverables [label="deliverables|id (PK)\lorder_id (FK)\lorder_stage_id (FK)\ldeliverable_type\lname\lfile_path\lfile_url\lfile_size\lmime_type\lis_verified\luploaded_by (FK)\lverified_by (FK)\lcreated_at\lupdated_at"];
  payments [label="payments|id (PK)\lorder_id (FK)\lpayment_type\lamount\lcurrency_code\lpayment_method\lpayment_date\lreceived_at\lstatus\lconfirmed_by (FK)\lcreated_by (FK)\lcreated_at\lupdated_at"];
  
  // Relationships
  // User & Role
  organizations -> organizations [label="parent_id" style=dashed];
  organizations -> organization_employees [label="organization_id"];
  users -> organization_employees [label="user_id"];
  users -> user_roles [label="user_id"];
  roles -> user_roles [label="role_id"];
  organizations -> users [label="organization_id" style=dashed];
  
  // Product Domain
  organizations -> products [label="vendor_id" style=dashed];
  product_categories -> products [label="category_id"];
  
  // Organization Extensions
  organizations -> vendor_extensions [label="organization_id" style=dashed];
  organizations -> agent_extensions [label="organization_id" style=dashed];
  
  // Customer Domain
  customer_sources -> customers [label="source_id"];
  customer_channels -> customers [label="channel_id"];
  customers -> customers [label="parent_customer_id" style=dashed];
  customers -> contacts [label="customer_id"];
  customers -> visa_records [label="customer_id"];
  customers -> orders [label="customer_id"];
  
  // User to Customer
  users -> customers [label="owner_user_id" style=dashed];
  organizations -> customers [label="agent_id" style=dashed];
  users -> customers [label="agent_user_id" style=dashed color=gray];
  
  // Order Domain
  order_statuses -> orders [label="status_id"];
  products -> orders [label="product_id"];
  users -> orders [label="sales_user_id"];
  orders -> order_assignments [label="order_id"];
  orders -> order_stages [label="order_id"];
  orders -> deliverables [label="order_id"];
  orders -> payments [label="order_id"];
  
  // User to Order Domain
  users -> order_assignments [label="assigned_to_user_id"];
  users -> order_assignments [label="assigned_by_user_id"];
  users -> order_stages [label="assigned_to_user_id"];
  users -> deliverables [label="uploaded_by"];
  users -> deliverables [label="verified_by"];
  users -> payments [label="confirmed_by"];
  users -> payments [label="created_by"];
  
  // Organization to Order Domain
  organizations -> order_assignments [label="vendor_id" style=dashed];
  organization_employees -> order_assignments [label="organization_employee_id"];
  organization_employees -> order_assignments [label="vendor_employee_id" style=dashed color=gray];
  
  // Order Stages to Deliverables
  order_stages -> deliverables [label="order_stage_id"];
}
