# BANTU CRM 系统技术栈选型报告

## 项目概述

为班兔企业服务提供精确的可拓展的全流程检测提高系统使用效率和财务统筹的自研ERP 软件 

## 技术架构总览

### 🏗️ 系统架构模式

- **微服务架构** - 服务解耦，独立部署和扩展
- **云原生设计** - 容器化部署，K8s编排
- **前后端分离** - API驱动，多端支持

### 后端技术

| 组件 | 技术选型 | 说明 |
|------|----------|------|
| **API框架** | FastAPI + PHP + LLM | 高性能异步框架 + 大语言模型智能集成 |
| **工作流引擎** | Activiti 7.x | 企业级业务流程管理 |
| **数据库** | PostgreSQL/MySQL | 关系型数据存储 |
| **缓存** | Redis | 高速缓存 & 会话管理 |
| **消息队列** | Celery + Redis | 异步任务处理 |
| **API文档** | Swagger/OpenAPI | 自动API文档生成 |

### 前端技术

| 组件 | 技术选型 | 说明 |
|------|----------|------|
| **前端框架** | React | 现代化用户界面 |
| **多端支持** | Web端 + 小程序 | 全平台覆盖 |
| **状态管理** | Redux/Zustand | 全局状态管理 |

### 运维与基础设施

| 组件 | 技术选型 | 说明 |
|------|----------|------|
| **容器编排** | Kubernetes + Docker | 容器化部署与管理 |
| **CI/CD** | Jenkins + Harbor | 自动化构建与部署 |
| **文档存储** | 阿里云OSS | 分布式文件存储 |
| **服务发现** | Consul/Nacos | 微服务治理 |
| **监控** | Prometheus + Grafana | 系统监控与告警 |


## 仓库结构与文档约定

- `docs/` 文档与设计说明（架构、数据库、接口规范等）
- `sql/` 数据库建表与迁移脚本（按序号前缀组织）

约定：
- SQL 文件命名采用升序前缀：`0001_*.sql`, `0002_*.sql`，确保可重复执行与可追踪演进。
- 优先支持 PostgreSQL；若需要 MySQL 变体，将在相同序号下提供 `_mysql.sql` 版本。
- 严格使用 `snake_case` 命名表与列；审计字段统一：`created_at`, `updated_at`, `created_by`, `updated_by`。

## 数据库核心域模型（首批）

- 多租户：`tenants`
- 用户与权限：`users`, `roles`, `user_roles`
- 客户域：`customers`, `contacts`

对应 SQL：
- `sql/0001_core_schema.sql`（PostgreSQL）

## 后续规划

- 线索、商机、活动、发票、收款、审批流等表在后续迁移中补充（`0002_*`, `0003_*` ...）。
- 提供测试数据脚本与视图、索引优化脚本。

## 平台用户与权限模型

### 用户角色与功能划分

1. ADMIN（管理员）

   - 用户管理
     - 创建/编辑/禁用用户
     - 分配用户角色和公司
   - 租户（公司）管理
     - 创建/编辑/删除租户（公司）
     - 管理租户状态（激活/禁用）
     - 查看所有租户数据统计
   - 产品管理
     - 添加/编辑产品服务
     - 设置产品价格（定价/渠道价/成本价）
   - 系统设置
     - 基础配置
     - 权限设置
   - 数据查看
     - 查看所有订单
     - 查看所有客户
     - 查看所有财务数据

2. 销售（SALES）

   2.1 公司内部销售
   - 客户管理
     - 创建新客户
     - 查看/编辑我的客户
     - 客户跟进记录
   - 订单管理
     - 创建新订单
     - 查看我的订单
     - 订单进度跟踪
   - 报价管理
     - 产品报价
     - 价格协商
   - 业绩查看
     - 个人业绩统计
     - 客户分析

   2.2 渠道代理销售（AGENT）
   - 客户管理
     - 创建下属客户
     - 查看我的渠道客户
   - 订单管理
     - 为渠道客户创建订单
     - 查看渠道订单进度
   - 佣金管理
     - 查看佣金统计
     - 佣金结算记录

3. 做单人员（OPERATION）

   3.1 公司内部录单人员
   - 订单接收
     - 查看分配订单
     - 接收订单任务
   - 进度管理
     - 更新订单进度
     - 上传相关文件
   - 客户沟通
     - 联系客户补充资料
     - 进度通知

   3.2 外部供应商做单人员
   - 任务接收
     - 查看分配的任务
     - 确认接收任务
   - 进度反馈
     - 更新任务进度
     - 提交完成证明
   - 成本记录
     - 记录实际成本
     - 提交费用账单

4. BANTU 财务（FINANCE）

   - 收款管理
     - 查看待收款订单
     - 标记收款状态
     - 催款操作
   - 付款管理
     - 审核供应商账单
     - 记录付款信息
   - 财务报表
     - 收入统计
     - 成本统计
     - 利润分析
   - 数据统计
     - 销售业绩统计
     - 订单完成统计
     - 客户分析报表

### 数据权限说明（粗粒度）

- ADMIN：所有公司的所有数据
- 销售：
  - 仅可见本公司客户与订单
  - 内部销售：仅可操作自己开发的客户
  - 渠道代理：仅可操作下属渠道客户
- 做单人员：
  - 内部做单：仅可见分配给自己的订单
  - 外部供应商：仅可见分配给自己的任务
- 财务：
  - 所有订单的财务数据
  - 所有客户的收款记录
  - 所有供应商的付款记录

说明：细粒度权限将通过角色-权限矩阵与资源作用域（按租户/公司/自身）实现，后续在 `docs/` 内提供矩阵表与策略示例。

### 公司类型（租户划分）

**重要**: 在BANTU CRM系统中，**每个公司/组织就是一个独立的租户**。

1. **BANTU 公司**（内部，建议作为一个租户）
   - 租户: BANTU总部
   - 包含：销售部、业务部、财务部等所有部门
   - 部门区分：通过用户角色（SALES/OPERATION/FINANCE）和客户分类（own/agent）

2. **渠道代理公司**（外部合作，每个代理一个租户）
   - 租户: 山海图代理
   - 租户: 360indo 代理
   - 租户: 其他渠道伙伴（每个独立租户）

3. **供应商公司**（外部服务，每个供应商一个租户）
   - 租户: Melinda 建筑资质
   - 租户: Winter 公司注册
   - 租户: 其他服务供应商（每个独立租户）

**租户划分原则**:
- 每个公司 = 一个租户
- 每个租户的数据完全隔离
- 公司内部部门通过角色和权限区分，而非租户

